<section class="records-page">
  <!-- Header -->
  <header class="page-header">
    <button class="back-btn" (click)="router.navigate(['/patient/dashboard'])">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </button>
    <h1 class="page-title">Health Records</h1>
    <div class="spacer"></div>
  </header>

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading records...</p>
    </div>
  } @else if (error) {
    <!-- Error State -->
    <div class="error-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2" class="error-icon">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <p class="error-message">{{ error }}</p>
      <button class="btn btn-primary" (click)="retry()">Try Again</button>
    </div>
  } @else {
    <!-- Tab Pills -->
    <div class="tabs-container">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'prescriptions'"
        (click)="setTab('prescriptions')"
      >
        Prescriptions
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'lab-results'"
        (click)="setTab('lab-results')"
      >
        Lab Results
      </button>
    </div>

    <!-- Content -->
    <div class="records-list">
      <!-- Prescriptions Tab -->
      @if (activeTab === 'prescriptions') {
        @if (prescriptions.length === 0) {
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="1.5" class="empty-icon">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
            <p class="empty-title">No prescriptions</p>
            <p class="empty-subtitle">Your prescriptions will appear here</p>
          </div>
        } @else {
          @for (rx of prescriptions; track rx.id) {
            <div class="record-card">
              <div class="record-header">
                <div class="record-icon rx-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="#2ECC71" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                </div>
                <div class="record-info">
                  <h3 class="record-title">{{ rx.code }}</h3>
                  <p class="record-date">{{ formatDate(rx.created_at) }}</p>
                </div>
                <span class="status-badge" [ngClass]="getStatusClass(rx.status)">
                  {{ getStatusLabel(rx.status) }}
                </span>
              </div>

              @if (rx.items && rx.items.length > 0) {
                <div class="medication-list">
                  @for (item of rx.items; track $index) {
                    <div class="medication-item">
                      <svg viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2" class="med-icon">
                        <circle cx="12" cy="12" r="1"/>
                      </svg>
                      <div class="med-details">
                        <span class="med-name">{{ item.name }}</span>
                        @if (item.dosage || item.frequency) {
                          <span class="med-dosage">
                            {{ item.dosage }}{{ item.frequency ? ' - ' + item.frequency : '' }}{{ item.duration ? ' (' + item.duration + ')' : '' }}
                          </span>
                        }
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          }
        }
      }

      <!-- Lab Results Tab -->
      @if (activeTab === 'lab-results') {
        @if (labOrders.length === 0) {
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="1.5" class="empty-icon">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
            <p class="empty-title">No lab results</p>
            <p class="empty-subtitle">Your lab results will appear here</p>
          </div>
        } @else {
          @for (order of labOrders; track order.id) {
            <div class="record-card">
              <div class="record-header">
                <div class="record-icon lab-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="#3B82F6" stroke-width="2">
                    <path d="M9 3h6v2H9zM12 5v6l-3.5 6.5a2 2 0 0 0 1.73 3h3.54a2 2 0 0 0 1.73-3L12 11V5z"/>
                  </svg>
                </div>
                <div class="record-info">
                  <h3 class="record-title">Lab Order</h3>
                  <p class="record-date">{{ formatDate(order.created_at) }}</p>
                  @if (order.specialist_name) {
                    <p class="record-doctor">Dr. {{ order.specialist_name }}</p>
                  }
                </div>
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ getStatusLabel(order.status) }}
                </span>
              </div>

              @if (order.tests && order.tests.length > 0) {
                <div class="test-list">
                  @for (test of order.tests; track $index) {
                    <div class="test-item">
                      <svg viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2" class="test-icon">
                        <circle cx="12" cy="12" r="1"/>
                      </svg>
                      <span>{{ test }}</span>
                    </div>
                  }
                </div>
              }

              <div class="lab-status-message" [ngClass]="'lab-' + order.status">
                @if (order.status === 'completed') {
                  <svg viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2" class="status-msg-icon">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                  <span>Results available - contact your doctor</span>
                } @else if (order.status === 'in_progress') {
                  <svg viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2" class="status-msg-icon">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                  </svg>
                  <span>In Progress</span>
                } @else {
                  <svg viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2" class="status-msg-icon">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  <span>Ordered</span>
                }
              </div>
            </div>
          }
        }
      }
    </div>
  }

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a class="nav-item" routerLink="/patient/dashboard">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
        <polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
      <span class="nav-label">Home</span>
    </a>
    <a class="nav-item" routerLink="/patient/appointments">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
      <span class="nav-label">Appointments</span>
    </a>
    <a class="nav-item" routerLink="/patient/profile">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
      <span class="nav-label">Profile</span>
    </a>
  </nav>
</section>
