@if (showConsultShell && consultationId) {
  <app-consult-shell
    [consultationId]="consultationId"
    [roomUrl]="roomUrl"
    [mode]="consultMode"
    role="patient"
    [gpName]="gpName"
    (leave)="onLeaveConsultShell()"
  ></app-consult-shell>
} @else {
  <section class="waiting-page">
    <div class="waiting-card">
    <!-- Pulse Animation -->
    <div class="pulse-container">
      <div class="pulse-ring"></div>
      <div class="pulse-ring pulse-ring--delayed"></div>
      <div class="pulse-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
        </svg>
      </div>
    </div>

    <h1 class="waiting-title">Waiting Room</h1>
    <p class="waiting-status">{{ statusMessage }}</p>

    @if (!roomUrl) {
      <div class="waiting-mode-indicator">
        <span class="mode-badge" [class]="'mode-' + consultMode">
          @if (consultMode === 'video') {
            Video Consultation
          } @else if (consultMode === 'audio') {
            Audio Consultation
          } @else {
            Chat Consultation
          }
        </span>
      </div>
      <p class="waiting-info">You will be connected when a GP is available. Please stay on this page.</p>
    }

    <div class="waiting-actions">
      @if (roomUrl) {
        <button class="btn btn-primary" type="button" (click)="joinConsult()">
          @if (consultMode === 'video') {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
              <polygon points="23 7 16 12 23 17 23 7"/>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
            </svg>
            Join Video Consultation
          } @else if (consultMode === 'audio') {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
            Join Audio Consultation
          } @else {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            Join Chat Consultation
          }
        </button>
      }
      <button class="btn btn-ghost" type="button" (click)="cancel()">
        Cancel & Go Back
      </button>
    </div>
  </div>
  </section>
}
