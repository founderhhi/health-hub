<section class="pharmacy-history">
  <div class="history-container">
    <!-- Page Header -->
    <header class="page-header">
      <h1 class="page-title">Prescription History</h1>
      <p class="page-subtitle">Review previously dispensed prescriptions</p>
    </header>

    <div class="loading-banner" *ngIf="loading" role="status">
      Loading prescription history...
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
      <div class="filter-grid">
        <div class="filter-group">
          <input
            type="text"
            class="filter-input"
            placeholder="Patient name"
            [(ngModel)]="filters.patientName"
            (ngModelChange)="onFilterChange()"
          />
        </div>
        <div class="filter-group">
          <input
            type="text"
            class="filter-input"
            placeholder="Prescription ID"
            [(ngModel)]="filters.prescriptionId"
            (ngModelChange)="onFilterChange()"
          />
        </div>
        <div class="filter-group">
          <select class="filter-select" [(ngModel)]="filters.status" (ngModelChange)="onFilterChange()">
            <option value="">All Statuses</option>
            <option value="completed">Completed</option>
            <option value="pending">Pending</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        <div class="filter-group">
          <select class="filter-select" [(ngModel)]="filters.dateRange" (ngModelChange)="onFilterChange()">
            <option value="">All Dates</option>
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
          </select>
        </div>
      </div>
      <div class="filter-actions" *ngIf="filters.patientName || filters.prescriptionId || filters.status || filters.dateRange">
        <button type="button" class="clear-filters-btn" (click)="clearFilters()">
          Clear Filters
        </button>
        <span class="results-count">{{ filteredItems.length }} result{{ filteredItems.length !== 1 ? 's' : '' }}</span>
      </div>
    </div>

    <!-- History List -->
    <div class="history-list-container" *ngIf="hasResults()">
      <div class="history-group" *ngFor="let groupKey of groupedItemsKeys">
        <h2 class="date-header">{{ groupKey }}</h2>
        <div class="history-list">
          <div class="history-item" *ngFor="let item of getItemsForGroup(groupKey)">
            <div class="history-item__icon-wrapper" [class.history-item__icon-wrapper--cancelled]="item.status === 'cancelled'" [class.history-item__icon-wrapper--pending]="item.status === 'pending'">
              <svg class="history-item__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <ng-container *ngIf="item.status === 'completed'">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                  <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </ng-container>
                <ng-container *ngIf="item.status === 'pending'">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </ng-container>
                <ng-container *ngIf="item.status === 'cancelled'">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="15" y1="9" x2="9" y2="15"></line>
                  <line x1="9" y1="9" x2="15" y2="15"></line>
                </ng-container>
              </svg>
            </div>
            <div class="history-item__info">
              <span class="history-item__title">{{ item.code }}</span>
              <span class="history-item__subtitle">{{ item.patientName }} â€¢ {{ item.itemCount }} item{{ item.itemCount !== 1 ? 's' : '' }}</span>
            </div>
            <div class="history-item__meta">
              <span class="history-item__time">{{ item.time }}</span>
              <span class="history-item__status" [class.status-completed]="item.status === 'completed'" [class.status-pending]="item.status === 'pending'" [class.status-cancelled]="item.status === 'cancelled'">
                {{ item.status | titlecase }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!hasResults()">
      <svg class="empty-state__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      <p class="empty-state__title">No prescriptions found</p>
      <p class="empty-state__subtitle">Try adjusting your filters</p>
    </div>
  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="bottom-nav">
    <a class="bottom-nav__item" routerLink="/pharmacy/scanner">
      <svg class="bottom-nav__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      <span class="bottom-nav__label">Scan</span>
    </a>
    <a class="bottom-nav__item" routerLink="/pharmacy">
      <svg class="bottom-nav__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      <span class="bottom-nav__label">Prescriptions</span>
    </a>
    <a class="bottom-nav__item bottom-nav__item--active" routerLink="/pharmacy/history">
      <svg class="bottom-nav__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      <span class="bottom-nav__label">History</span>
    </a>
  </nav>
</section>
