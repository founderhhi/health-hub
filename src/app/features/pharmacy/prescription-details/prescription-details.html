<section class="prescription-details">
  <div class="prescription-container">
    @if (loading) {
      <div class="inline-status">Loading prescription...</div>
    }
    @if (errorMessage) {
      <div class="inline-status inline-status--error">{{ errorMessage }}</div>
    }

    <!-- Back Button -->
    <div class="prescription-header">
      <button class="back-button" (click)="goBack()">
        <svg class="back-button__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"></path>
        </svg>
        <span>Back</span>
      </button>
    </div>

    <!-- Prescription ID & Patient -->
    <div class="prescription-info">
      <h1 class="prescription-id">{{ prescription?.code || 'RX-...' }}</h1>
      <p class="patient-identifier">Patient: {{ prescription?.patient_id || 'Patient' }}</p>
    </div>

    <!-- Progress Indicator -->
    <div class="dispensing-progress">
      <div class="progress-label">
        <span>Items to Dispense: {{ prescription?.items?.length || 0 }}</span>
        <span class="progress-label__count">Items Checked: 0</span>
      </div>
      <div class="progress-bar">
        <div class="progress-bar__fill" style="width: 0%;"></div>
      </div>
    </div>

    <!-- Medication Cards -->
    <div class="medications-section">
      <h2 class="section-title">Medications</h2>
      
      <div class="medication-card" *ngFor="let item of prescription?.items">
        <label class="medication-card__checkbox-wrapper">
          <input
            type="checkbox"
            class="medication-card__checkbox"
            [disabled]="true"
            [attr.aria-label]="'Dispense status for ' + (item.name || 'medication')"
          />
          <span class="medication-card__checkmark"></span>
        </label>
        <div class="medication-card__info">
          <div class="medication-card__name">{{ item.name || 'Medication' }}</div>
          <div class="medication-card__dosage">
            {{ item.dosage || '' }} {{ item.frequency || '' }} {{ item.duration || '' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Prescriber Info -->
    <div class="prescriber-section">
      <h2 class="section-title">Prescriber</h2>
      <div class="prescriber-card">
        <div class="prescriber-avatar">DS</div>
        <div class="prescriber-details">
          <span class="prescriber-name">Dr. David Smith</span>
          <span class="prescriber-license">License: MED-2024-XXXXX</span>
          <span class="prescription-date">Prescribed: Jan 15, 2024</span>
        </div>
      </div>
    </div>

    <!-- Privacy Badges -->
    <div class="privacy-section">
      <h2 class="section-title">Privacy & Verification</h2>
      <div class="privacy-badges">
        <span class="privacy-badge privacy-badge--verified">
          <svg class="privacy-badge__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Verified Prescriber
        </span>
        <span class="privacy-badge privacy-badge--secure">
          <svg class="privacy-badge__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          Encrypted
        </span>
      </div>
    </div>
  </div>

  <!-- Sticky Action Footer -->
  <div class="sticky-footer">
    <div class="sticky-footer__actions">
      <button type="button" class="action-button action-button--secondary" [disabled]="true">
        Mark All as Dispensed
      </button>
      <p class="action-unavailable-reason">{{ unavailableActionsReason }}</p>
      <button type="button" class="action-button action-button--primary" (click)="completeDispensing()" [disabled]="!prescription || prescription?.status === 'claimed'">
        Complete Dispensing
      </button>
    </div>
  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="bottom-nav">
    <a class="bottom-nav__item" routerLink="/pharmacy/scanner">
      <svg class="bottom-nav__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      <span class="bottom-nav__label">Scan</span>
    </a>
    <a class="bottom-nav__item bottom-nav__item--active" routerLink="/pharmacy">
      <svg class="bottom-nav__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      <span class="bottom-nav__label">Prescriptions</span>
    </a>
    <a class="bottom-nav__item" routerLink="/pharmacy/history">
      <svg class="bottom-nav__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      <span class="bottom-nav__label">History</span>
    </a>
  </nav>
</section>
